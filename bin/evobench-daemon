#!/bin/bash
set -meuo pipefail
IFS=

usage() {
    {
	evobench-jobs run daemon --help || true
	echo
	evobench-jobs run daemon help 2>&1 || true
    } | grep -E -v "For more information try --help" | sed 's/error: Invalid value "help" for /\nFor /' | less
    exit 0
}


if [ $# -eq 0 ]; then
    usage
elif [ $# -eq 1 ]; then
    if [ "$1" = "-h" -o "$1" = --help -o "$1" = help ]; then
        usage
    fi
    command="$1"
else
    echo "$0: Please only give exactly 1 argument" >&2
    exit 1
fi


cd

export SILOBENCHMARKING_KEPT_BINARIES_BASEDIR=~/www_data/release_downloads

mkdir -p "$SILOBENCHMARKING_KEPT_BINARIES_BASEDIR"

source ~/venv/bin/activate

# To enable backtraces on errors (but note that they are enabled not
# just for panics, but also for normal errors like wrong usage, which
# may be confusing, thus don't do it by default):

# export RUST_BACKTRACE=1

evobench-jobs run daemon "$command"

